<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Cesium 3D Buildings Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/cesium@1.117/Build/Cesium/Cesium.js"></script>
<link href="https://cdn.jsdelivr.net/npm/cesium@1.117/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
<style>
html, body { width: 100%; height: 100%; margin: 0; padding: 0; font-family: Arial, sans-serif; }
#container { display: flex; width: 100%; height: 100%; }
#sidePanel { width: 350px; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; box-sizing: border-box; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.3); }
#cesiumContainer { flex: 1; height: 100%; }
.panel-section { margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; backdrop-filter: blur(10px); }
.panel-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #fff; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 8px; }
.stat-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px; }
.color-legend { display: flex; align-items: center; margin-bottom: 8px; }
.color-box { width: 20px; height: 20px; border-radius: 3px; margin-right: 10px; border: 1px solid rgba(255,255,255,0.3); }
input, select, button { width: 100%; padding: 8px; margin-bottom: 10px; border: none; border-radius: 5px; font-size: 14px; }
button { background: linear-gradient(45deg, #FF6B6B, #4ECDC4); color: white; cursor: pointer; font-weight: bold; transition: transform 0.2s; }
button:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
.filter-controls { display: flex; gap: 10px; }
.filter-controls input { flex: 1; }
#stats { font-size: 12px; }
</style>
</head>
<body>
<div id="container">
  <div id="sidePanel">
    <h2 style="text-align: center; margin-bottom: 30px; color: #fff;">ğŸ¢ Building Dashboard</h2>

    <div class="panel-section">
      <div class="panel-title">ğŸ“Š Statistics</div>
      <div id="stats">
        <div class="stat-item"><span>Total Buildings:</span><span id="totalBuildings">Loading...</span></div>
        <div class="stat-item"><span>Avg Height:</span><span id="avgHeight">Loading...</span></div>
        <div class="stat-item"><span>Max Height:</span><span id="maxHeight">Loading...</span></div>
        <div class="stat-item"><span>Total Area:</span><span id="totalArea">Loading...</span></div>
      </div>
    </div>

    <div class="panel-section">
      <div class="panel-title">ğŸ¨ Height Color Code</div>
      <div class="color-legend"><div class="color-box" style="background: #00ff00;"></div><span>3m</span></div>
      <div class="color-legend"><div class="color-box" style="background: #ccff00;"></div><span>6m</span></div>
      <div class="color-legend"><div class="color-box" style="background: #ffaa00;"></div><span>9m</span></div>
      <div class="color-legend"><div class="color-box" style="background: #ff4444;"></div><span>12m+</span></div>
    </div>

    <div class="panel-section">
      <div class="panel-title">âœ… Compliance Legend</div>
      <div class="color-legend"><div class="color-box" style="background: gray;"></div>Not Applicable</div>
      <div class="color-legend"><div class="color-box" style="background: green;"></div>Compliant</div>
      <div class="color-legend"><div class="color-box" style="background: orange;"></div>Partial Compliance</div>
      <div class="color-legend"><div class="color-box" style="background: red;"></div>Non-compliant</div>
    </div>

    <div class="panel-section">
      <div class="panel-title">ğŸ” Spatial Queries</div>
      <label>Property Type:</label>
      <select id="propertyTypeFilter">
        <option value="">All Types</option>
        <option value="Commercial">Commercial</option>
        <option value="Institutional">Institutional</option>
        <option value="Vacant">Vacant</option>
      </select>
      <label>Building Use:</label>
      <select id="buildingUseFilter">
        <option value="">All Uses</option>
        <option value="House">House</option>
        <option value="Shop">Shop</option>
        <option value="Warehouse">Warehouse</option>
      </select>
      <label>Height Range (meters):</label>
      <div class="filter-controls">
        <input type="number" id="minHeight" placeholder="Min" min="0">
        <input type="number" id="maxHeight" placeholder="Max" min="0">
      </div>
      <label>Floor Count:</label>
      <select id="floorsFilter">
        <option value="">All Floors</option>
        <option value="1">1 Floor</option>
        <option value="2">2 Floors</option>
        <option value="3">3+ Floors</option>
      </select>
      <button onclick="applyFilters()">ğŸ” Apply Filters</button>
      <button onclick="resetFilters()">ğŸ”„ Reset All</button>
    </div>

    <div class="panel-section">
      <div class="panel-title">ğŸ“ˆ Quick Analysis</div>
      <button onclick="highlightTallBuildings()">ğŸ—ï¸ Show Tall Buildings</button>
      <button onclick="highlightByPropertyType()">ğŸ¢ Group by Property Type</button>
      <button onclick="showFloodProne()">ğŸŒŠ Flood Prone Areas</button>
      <button onclick="highlightByCompliance()">âœ… Compliance Status</button>
      <button onclick="resetView()">ğŸŒ Reset View</button>
    </div>

    <div class="panel-section" id="selectedInfo" style="display: none;">
      <div class="panel-title">ğŸ“‹ Selected Building</div>
      <div id="buildingDetails"></div>
    </div>
  </div>

  <div id="cesiumContainer"></div>
</div>

<script>
Cesium.Ion.defaultAccessToken = 'YOUR_ION_TOKEN_HERE';

// MapTiler base map
viewer = new Cesium.Viewer('cesiumContainer', {
    imageryProvider: new Cesium.UrlTemplateImageryProvider({
        url: 'https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=6TYA91HhQPjMXU651wBM',
        credit: 'MapTiler'
    }),
    baseLayerPicker: false,
    terrainProvider: Cesium.createWorldTerrain(),
    timeline: false,
    animation: false
});

// Globals
let dataSource, allBuildings=[], filteredBuildings=[];

// Smooth gradient color based on height
function getColorByHeight(height){
    if(height<=3) return Cesium.Color.fromHsl(0.33,1,0.5); // Green
    if(height<=6) return Cesium.Color.fromHsl(0.25,1,0.5); // Yellow-Green
    if(height<=9) return Cesium.Color.fromHsl(0.13,1,0.5); // Orange
    return Cesium.Color.fromHsl(0,1,0.5); // Red
}

function getColorByPropertyType(type){
    switch(type){
        case 'Commercial': return Cesium.Color.fromCssColorString('#ff6b6b');
        case 'Institutional': return Cesium.Color.fromCssColorString('#4ecdc4');
        case 'Vacant': return Cesium.Color.fromCssColorString('#45b7d1');
        default: return Cesium.Color.fromCssColorString('#96ceb4');
    }
}

// Load GeoJSON
Cesium.GeoJsonDataSource
