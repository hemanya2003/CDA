<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>3D Building Dashboard - MapLibre + OSM</title>
<link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet"/>
<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<style>
html, body { margin: 0; padding: 0; height: 100%; width: 100%; font-family: Arial, sans-serif; }
#container { display: flex; width: 100%; height: 100%; }
#sidePanel { width: 350px; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; box-sizing: border-box; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.3); }
#map { flex: 1; height: 100%; }
.panel-section { margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; backdrop-filter: blur(10px); }
.panel-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #fff; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 8px; }
.stat-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px; }
.color-legend { display: flex; align-items: center; margin-bottom: 8px; }
.color-box { width: 20px; height: 20px; border-radius: 3px; margin-right: 10px; border: 1px solid rgba(255,255,255,0.3); }
input, select, button { width: 100%; padding: 8px; margin-bottom: 10px; border: none; border-radius: 5px; font-size: 14px; }
button { background: linear-gradient(45deg, #FF6B6B, #4ECDC4); color: white; cursor: pointer; font-weight: bold; transition: transform 0.2s; }
button:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
.filter-controls { display: flex; gap: 10px; }
.filter-controls input { flex: 1; }
#stats { font-size: 12px; }
</style>
</head>
<body>

<div id="container">
  <div id="sidePanel">
    <h2 style="text-align:center; margin-bottom:30px; color:#fff;">ğŸ¢ Building Dashboard</h2>
    
    <!-- Statistics -->
    <div class="panel-section">
      <div class="panel-title">ğŸ“Š Statistics</div>
      <div id="stats">
        <div class="stat-item"><span>Total Buildings:</span><span id="totalBuildings">0</span></div>
        <div class="stat-item"><span>Avg Height:</span><span id="avgHeight">0m</span></div>
        <div class="stat-item"><span>Max Height:</span><span id="maxHeight">0m</span></div>
        <div class="stat-item"><span>Total Area:</span><span id="totalArea">0 sq.m</span></div>
      </div>
    </div>

    <!-- Color Legend -->
    <div class="panel-section">
      <div class="panel-title">ğŸ¨ Height Color Code</div>
      <div class="color-legend"><div class="color-box" style="background:lightgray;"></div><span>3m</span></div>
      <div class="color-legend"><div class="color-box" style="background:royalblue;"></div><span>6m</span></div>
      <div class="color-legend"><div class="color-box" style="background:lightblue;"></div><span>9m</span></div>
      <div class="color-legend"><div class="color-box" style="background:red;"></div><span>12m+</span></div>
    </div>

    <!-- Compliance Legend -->
    <div class="panel-section">
      <div class="panel-title">âœ… Compliance</div>
      <div class="color-legend"><div class="color-box" style="background:gray;"></div>Not Applicable</div>
      <div class="color-legend"><div class="color-box" style="background:green;"></div>Compliant</div>
      <div class="color-legend"><div class="color-box" style="background:orange;"></div>Partial Compliance</div>
      <div class="color-legend"><div class="color-box" style="background:red;"></div>Non-compliant</div>
    </div>

    <!-- Filters -->
    <div class="panel-section">
      <div class="panel-title">ğŸ” Spatial Queries</div>
      <label>Property Type:</label>
      <select id="propertyTypeFilter"><option value="">All Types</option><option>Commercial</option><option>Institutional</option><option>Vacant</option></select>
      <label>Building Use:</label>
      <select id="buildingUseFilter"><option value="">All Uses</option><option>House</option><option>Shop</option><option>Warehouse</option></select>
      <label>Height Range:</label>
      <div class="filter-controls">
        <input type="number" id="minHeight" placeholder="Min">
        <input type="number" id="maxHeight" placeholder="Max">
      </div>
      <label>Floor Count:</label>
      <select id="floorsFilter"><option value="">All Floors</option><option value="1">1 Floor</option><option value="2">2 Floors</option><option value="3">3+ Floors</option></select>
      <button onclick="applyFilters()">ğŸ” Apply Filters</button>
      <button onclick="resetFilters()">ğŸ”„ Reset All</button>
    </div>

    <!-- Analysis -->
    <div class="panel-section">
      <div class="panel-title">ğŸ“ˆ Quick Analysis</div>
      <button onclick="highlightTallBuildings()">ğŸ—ï¸ Show Tall Buildings</button>
      <button onclick="highlightByPropertyType()">ğŸ¢ Group by Property Type</button>
      <button onclick="showFloodProne()">ğŸŒŠ Flood Prone Areas</button>
      <button onclick="highlightByCompliance()">âœ… Compliance Status</button>
      <button onclick="resetMapView()">ğŸŒ Reset View</button>
    </div>

    <!-- Selected Building Info -->
    <div class="panel-section" id="selectedInfo" style="display:none;">
      <div class="panel-title">ğŸ“‹ Selected Building</div>
      <div id="buildingDetails"></div>
    </div>

  </div>

  <!-- Map -->
  <div id="map"></div>
</div>

<script>
// Initialize MapLibre with OpenStreetMap raster tiles
const map = new maplibregl.Map({
    container: 'map',
    style: {
        version: 8,
        sources: {
            osm: {
                type: 'raster',
                tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                tileSize: 256,
                attribution: 'Â© OpenStreetMap contributors'
            }
        },
        layers: [
            { id: 'osm', type: 'raster', source: 'osm' }
        ]
    },
    center: [85.854, 20.466],
    zoom: 17,
    pitch: 60,
    bearing: -17,
    antialias: true
});
map.dragRotate.enable();
map.touchZoomRotate.enableRotation();
map.addControl(new maplibregl.NavigationControl());

// Load GeoJSON buildings
let allBuildings = [];
fetch('./Sector6Final1.geojson')
  .then(res => res.json())
  .then(data => {
      allBuildings = data.features.map(f=>{
          f.properties.height = parseFloat(f.properties.height_m || f.properties.height || 3);
          f.properties.floors = parseInt(f.properties.floors || 1);
          return f;
      });
      map.on('load', ()=>{
          map.addSource('buildings', { type:'geojson', data:{ type:'FeatureCollection', features: allBuildings } });
          map.addLayer({
              id:'buildings-layer',
              type:'fill-extrusion',
              source:'buildings',
              paint:{
                  'fill-extrusion-color':['interpolate', ['linear'], ['get','height'],
                      3,'lightgray',
                      6,'royalblue',
                      9,'lightblue',
                      12,'red'
                  ],
                  'fill-extrusion-height':['*',['get','height'],1.2],
                  'fill-extrusion-base':0,
                  'fill-extrusion-opacity':0.9
              }
          });
          updateStatistics();
      });
  });

// Statistics
function updateStatistics(){
    const heights = allBuildings.map(b=>b.properties.height);
    const total = allBuildings.length;
    const avg = total>0 ? (heights.reduce((a,b)=>a+b,0)/total).toFixed(1):0;
    const maxH = total>0 ? Math.max(...heights):0;
    document.getElementById('totalBuildings').innerText = total;
    document.getElementById('avgHeight').innerText = avg+'m';
    document.getElementById('maxHeight').innerText = maxH+'m';
    const totalArea = allBuildings.reduce((a,b)=>a+(b.properties.AREA||0),0);
    document.getElementById('totalArea').innerText = totalArea.toFixed(1)+' sq.m';
}

// Filters and Analysis functions (you can implement similar to previous code)
// ...

</script>
</body>
</html>
